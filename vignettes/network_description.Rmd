---
title: "Description of the network"
author: Loukia M. Spineli
date: "Latest version: `r Sys.Date()`"
source: vignettes/network_description.Rmd
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
params:
  EVAL: !r identical(Sys.getenv("NOT_CRAN"), "true")
vignette: >
  %\VignetteIndexEntry{Description of the network}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(rnmamod)
```

## Introduction

This vignette aims to illustrate the toolkits of the **rnmamod** package for the creation of the network plot and summarisation of the corresponding outcome data. If missing participant outcome data (MOD) have been extracted for all trials of the dataset, the **rnmamod** package facilitates visualising the proportion of MOD across the network and dataset.

## Example on a binary outcome 

### Dataset preparation

We will use the systematic review of [Baker et al. (2009)](https://pubmed.ncbi.nlm.nih.gov/19637942/) that comprises 21 trials comparing seven pharmacological interventions with each other and placebo in patients with chronic obstructive pulmonary disease (COPD). The exacerbation of COPD (harmful outcome) is the analysed *binary* outcome. 

```{r comment = NA}
nma.baker2009
```

The dataset has the one-trial-per-row format containing arm-level data for each trial. This format is widely used for BUGS models. For a binary outcome, the dataset must have a minimum of three items: 

- item `t` that refers to the intervention identifier for the corresponding intervention arm;
- item `r` that refers to the number of observed events in the corresponding intervention arm. 
- item `n` that refers to the number of randomised participants in the corresponding intervention arm.

If there is at least one trial that reports the number of missing participants per intervention arm, we also include the item `m` in the dataset. If a trial reports the *total* number of missing participants rather than the number of missing participants per intervention arm, we indicate with `NA` in the item `m` the intervention arms of the corresponding trial.

### The network plot

The function `netplot` (see ?netplot for help) creates the network plot using only two arguments: the `data` for the dataset (in one-trial-per-row format) and `drug.names` for the names of each intervention in the dataset.

```{r, results = "hide", fig.show = "hide"}
netplot(data = nma.baker2009, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```

```{r, echo = FALSE, results = "hide", fig.width = 5, fig.height = 5, fig.align = "center"}
netplot(data = nma.baker2009, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```

The intervention names in `drug.names` must be sorted in the ascending order of their identifier. Hence, `1` in the item `t` refers to `PBO` (placebo), `2` to `BUD` (budesonide), `3` to `BUD+` (budesonide plus formoterol) and so on. See the 'Details' in ?nma.baker2009 for names of the interventions.

### Network characteristics

`netplot` also produces a table with the characteristics of the network, such as the number of interventions, number of possible comparisons, number of direct comparisons (i.e., comparisons of interventions informed by at least one trial), and so on:

```{r, echo = FALSE, fig.show = "hide"}
net <- netplot(data = nma.baker2009, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
net$Network.description
```

### Distribution of the outcome

Furthermore, `netplot` returns a table that summarises the number of trials, number of randomised participants and the proportion of completers (participants who completed the trial) **per intervention**. In the case of a binary outcome, the table additionally illustrates the distribution of the outcome as proportion: 

```{r, echo = FALSE, fig.show = "hide"}
net$Table.interventions
```

An identical table is returned for the **observed comparisons** in the network:

```{r, echo = FALSE, fig.show = "hide"}
net$Table.comparisons
```

The users can export all tables in Excel 'xlsx' format at the working directory of their project by adding the argument `save.xls = TRUE` in the `netplot` function.

### Distribution of missing participants 

When missing participants have been reported for each intervention arm of at least one trial, we use the `heatmap.missing.network` function to illustrate the proportion of missing participants **per intervention** (main diagonal) and **observed comparison** (lower off-diagonal) in the network:

```{r, results = "hide", fig.show = "hide"}
heatmap.missing.network(data = nma.baker2009, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```

```{r, echo = FALSE, results = "hide", fig.width = 7, fig.height = 7, fig.align = "center"}
heatmap.missing.network(data = nma.baker2009, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```

The `heatmap.missing.dataset` function illustrates the proportion of missing participants for each arm of every trial in the dataset:

```{r, results = "hide", fig.show = "hide"}
heatmap.missing.dataset(data = nma.baker2009, trial.names = nma.baker2009$study, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```

```{r, echo = FALSE, results = "hide", fig.width = 7, fig.height = 7, fig.align = "center"}
heatmap.missing.dataset(data = nma.baker2009, trial.names = nma.baker2009$study, drug.names = c("PBO", "BUD", "BUD+", "FLU", "FLU+", "FOR", "SAL", "TIO"))
```


## References

Lifeng Lin, Jing Zhang, James S. Hodges, Haitao Chu. Performing Arm-Based Network Meta-Analysis in R
with the pcnetmeta Package. \emph{J Stat Softw} 2017;\bold{80}(5): 1--25. [doi: 10.18637/jss.v080.i05](https://www.jstatsoft.org/article/view/v080i05)
